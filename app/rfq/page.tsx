'use client';import {useSearchParams} from 'next/navigation';import {useState} from 'react';export default function RFQ(){const params=useSearchParams();const initialSKU=params.get('sku')??'';const [form,setForm]=useState({company:'',email:'',whatsapp:'',forwarder:'',forwarderAddr:'',forwarderContact:'',items:initialSKU?[{sku:initialSKU,qty:1}]:[] as {sku:string;qty:number}[]});function u(k:any,v:any){setForm(p=>({...p,[k]:v}))}function add(){setForm(p=>({...p,items:[...p.items,{sku:'',qty:1}]}))}async function go(){const res=await fetch('/api/proforma',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(form)});if(!res.ok){alert('Failed to generate pro forma');return;}const orderNo=res.headers.get('x-order-no')||'';const blob=await res.blob();const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='Pro-Forma-Invoice.pdf';a.click();URL.revokeObjectURL(url);const message=encodeURIComponent(`Hi, I just submitted an RFQ. Order: ${orderNo}. Company: ${form.company}. Forwarder: ${form.forwarder}.`);window.open(`https://wa.me/17542075750?text=${message}`,'_blank');}return(<main className='container py-8 max-w-2xl'><h1 className='text-xl font-semibold'>Request a Quote</h1><p className='text-sm muted'>We do not arrange shipping. Delivery to your Miami forwarder (FCA).</p><div className='card p-4 mt-4 space-y-3'><input className='input' placeholder='Company Legal Name' value={form.company} onChange={e=>u('company',e.target.value)}/><input className='input' placeholder='Email' value={form.email} onChange={e=>u('email',e.target.value)}/><input className='input' placeholder='WhatsApp' value={form.whatsapp} onChange={e=>u('whatsapp',e.target.value)}/><input className='input' placeholder='Freight Forwarder (Miami)' value={form.forwarder} onChange={e=>u('forwarder',e.target.value)}/><input className='input' placeholder='Forwarder Address' value={form.forwarderAddr} onChange={e=>u('forwarderAddr',e.target.value)}/><input className='input' placeholder='Forwarder Contact' value={form.forwarderContact} onChange={e=>u('forwarderContact',e.target.value)}/><div className='border-t pt-3'><div className='font-medium'>Items</div>{form.items.map((it,idx)=>(<div className='flex gap-2 mt-2' key={idx}><input className='input' placeholder='SKU' value={it.sku} onChange={e=>{const v=e.target.value;u('items',form.items.map((x,i)=>i===idx?{...x,sku:v}:x));}}/><input className='input w-28' placeholder='Qty' type='number' min={1} value={it.qty} onChange={e=>{const v=Math.max(1,parseInt(e.target.value||'1',10));u('items',form.items.map((x,i)=>i===idx?{...x,qty:v}:x));}}/></div>))}<button className='btn mt-2' onClick={add}>Add Item</button></div><button className='btn btn-primary w-full' onClick={go}>Generate Pro Forma</button><div className='text-xs muted'>By submitting you agree to our Policies and FCA Miami handoff terms.</div></div></main>)}